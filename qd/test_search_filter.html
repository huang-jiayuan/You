<!DOCTYPE html>
<html>
<head>
    <title>房间搜索和筛选测试</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; width: 200px; }
        .result { margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 4px; }
        .loading { color: #007bff; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
    </style>
</head>
<body>
    <h1>房间搜索和筛选功能测试</h1>
    
    <!-- 推荐房间测试 -->
    <div class="section">
        <h2>1. 推荐房间</h2>
        <button class="button" onclick="testRecommendRooms()">获取推荐房间</button>
        <div id="recommendResult" class="result"></div>
    </div>
    
    <!-- 搜索功能测试 -->
    <div class="section">
        <h2>2. 房间搜索</h2>
        <input type="text" id="searchKeyword" class="input" placeholder="输入搜索关键词" value="房间" />
        <button class="button" onclick="testSearchRooms()">搜索房间</button>
        <div id="searchResult" class="result"></div>
    </div>
    
    <!-- 标签筛选测试 -->
    <div class="section">
        <h2>3. 标签筛选</h2>
        <select id="tagSelect" class="input">
            <option value="0">全部</option>
            <option value="1">热门</option>
            <option value="2">娱乐</option>
            <option value="3">交友</option>
            <option value="4">才艺</option>
            <option value="5">电台音乐</option>
        </select>
        <button class="button" onclick="testFilterByTag()">按标签筛选</button>
        <div id="filterResult" class="result"></div>
    </div>
    
    <!-- 标签列表测试 -->
    <div class="section">
        <h2>4. 标签列表</h2>
        <button class="button" onclick="testGetTags()">获取标签列表</button>
        <div id="tagsResult" class="result"></div>
    </div>

    <script>
        // 测试推荐房间
        async function testRecommendRooms() {
            const resultDiv = document.getElementById('recommendResult');
            resultDiv.innerHTML = '<span class="loading">正在获取推荐房间...</span>';
            
            try {
                const response = await fetch('/api/room/getRecommendRooms', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ page: 1, pageSize: 10 })
                });
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="success">✓ 推荐房间获取成功</div>
                    <p><strong>状态码:</strong> ${data.code}</p>
                    <p><strong>消息:</strong> ${data.msg}</p>
                    <p><strong>房间数量:</strong> ${data.data?.rooms?.length || 0}</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">✗ 获取推荐房间失败: ${error.message}</div>`;
            }
        }
        
        // 测试搜索房间
        async function testSearchRooms() {
            const keyword = document.getElementById('searchKeyword').value;
            const resultDiv = document.getElementById('searchResult');
            
            if (!keyword.trim()) {
                resultDiv.innerHTML = '<div class="error">请输入搜索关键词</div>';
                return;
            }
            
            resultDiv.innerHTML = '<span class="loading">正在搜索房间...</span>';
            
            try {
                const response = await fetch('/api/room/searchRooms', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        keyword: keyword.trim(), 
                        page: 1, 
                        pageSize: 10 
                    })
                });
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="success">✓ 房间搜索完成</div>
                    <p><strong>搜索关键词:</strong> ${keyword}</p>
                    <p><strong>状态码:</strong> ${data.code}</p>
                    <p><strong>消息:</strong> ${data.msg}</p>
                    <p><strong>搜索结果数量:</strong> ${data.data?.rooms?.length || 0}</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">✗ 搜索房间失败: ${error.message}</div>`;
            }
        }
        
        // 测试标签筛选
        async function testFilterByTag() {
            const tagId = document.getElementById('tagSelect').value;
            const resultDiv = document.getElementById('filterResult');
            
            resultDiv.innerHTML = '<span class="loading">正在按标签筛选房间...</span>';
            
            try {
                const response = await fetch('/api/room/getRoomsByCategory', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        tagId: parseInt(tagId), 
                        page: 1, 
                        pageSize: 10 
                    })
                });
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="success">✓ 标签筛选完成</div>
                    <p><strong>标签ID:</strong> ${tagId}</p>
                    <p><strong>状态码:</strong> ${data.code}</p>
                    <p><strong>消息:</strong> ${data.msg}</p>
                    <p><strong>筛选结果数量:</strong> ${data.data?.rooms?.length || 0}</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">✗ 标签筛选失败: ${error.message}</div>`;
            }
        }
        
        // 测试获取标签列表
        async function testGetTags() {
            const resultDiv = document.getElementById('tagsResult');
            resultDiv.innerHTML = '<span class="loading">正在获取标签列表...</span>';
            
            // 由于后端没有标签接口，这里显示前端默认的标签列表
            const tags = [
                { id: 0, name: '全部', color: '#667eea' },
                { id: 1, name: '热门', color: '#ff6b9d' },
                { id: 2, name: '娱乐', color: '#4facfe' },
                { id: 3, name: '交友', color: '#fa709a' },
                { id: 4, name: '才艺', color: '#f093fb' },
                { id: 5, name: '电台音乐', color: '#764ba2' }
            ];
            
            resultDiv.innerHTML = `
                <div class="success">✓ 标签列表（前端默认）</div>
                <p><strong>标签数量:</strong> ${tags.length}</p>
                <pre>${JSON.stringify(tags, null, 2)}</pre>
            `;
        }
        
        // 页面加载时自动测试推荐房间
        window.onload = function() {
            testRecommendRooms();
        };
    </script>
</body>
</html>